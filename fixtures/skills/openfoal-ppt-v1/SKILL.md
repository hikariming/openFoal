---
name: openfoal-ppt-v1
description: Generate a real PPTX file with Node + PptxGenJS from JSON args. Always produce both .pptx and .meta.json outputs.
source: daymade/claude-code-skills (adapted for OpenFoal)
license: MIT
---

# OpenFoal PPT V1 Skill

## Purpose
Generate a strict `.pptx` artifact (not markdown fallback).

## Invocation
Use this skill through:

- `/skill:openfoal-ppt-v1 {"title":"...","slides":8,"lang":"zh-CN","out":"./.openfoal/output/demo.pptx"}`

## Args Contract
Read JSON from the `[Skill Args]` section appended to the input. Parse exactly one JSON object.

`PptSkillArgs` fields:

- `title: string` (required, fallback `OpenFoal Deck`)
- `slides: number` (required range `3-30`, fallback `8`)
- `lang: "zh-CN" | "en-US"` (fallback `zh-CN`)
- `out: string` (required, fallback `./.openfoal/output/demo.pptx`)
- `theme?: string` (optional)

## Non-Negotiable Rules

1. Always generate real `.pptx` using Node + `pptxgenjs`.
2. Always generate `${out}.meta.json`.
3. Never return markdown as final artifact.
4. Do not ask follow-up questions when args are present.
5. Use OpenFoal tools only (`file.write`, `bash.exec`, optional `file.read` for verify).

## Mandatory Workflow

1. Parse and normalize args.
2. Write generator script to `./.openfoal/output/.tmp/openfoal-ppt-v1-generate.mjs` using `file.write`.
3. Write normalized args to `./.openfoal/output/.tmp/openfoal-ppt-v1-args.json` using `file.write`.
4. Execute generator with `bash.exec`:
   - `node ./.openfoal/output/.tmp/openfoal-ppt-v1-generate.mjs ./.openfoal/output/.tmp/openfoal-ppt-v1-args.json`
5. Verify outputs with `bash.exec`:
   - `ls -l <out> <out>.meta.json`
6. Return a short result including `out`, `slideCount`, and checksum from meta file.

## Generator Script Template

Write this exact script body (replace only if bug fix is required):

```js
import fs from "node:fs/promises";
import path from "node:path";
import { createHash } from "node:crypto";
import PptxGenJS from "pptxgenjs";

const argsFile = process.argv[2];
if (!argsFile) {
  throw new Error("args file is required");
}

const raw = JSON.parse(await fs.readFile(argsFile, "utf8"));
const title = typeof raw.title === "string" && raw.title.trim().length > 0 ? raw.title.trim() : "OpenFoal Deck";
const lang = raw.lang === "en-US" ? "en-US" : "zh-CN";
const slides = Number.isFinite(Number(raw.slides)) ? Math.trunc(Number(raw.slides)) : 8;
const slideCount = Math.min(30, Math.max(3, slides));
const out = typeof raw.out === "string" && raw.out.trim().length > 0 ? raw.out.trim() : "./.openfoal/output/demo.pptx";
const theme = typeof raw.theme === "string" ? raw.theme.trim() : "";

const cwd = path.resolve(process.cwd());
const outAbs = path.resolve(cwd, out);
if (!(outAbs === cwd || outAbs.startsWith(`${cwd}${path.sep}`))) {
  throw new Error(`out path escapes workspace: ${out}`);
}

await fs.mkdir(path.dirname(outAbs), { recursive: true });

const pptx = new PptxGenJS();
pptx.layout = "LAYOUT_WIDE";
pptx.author = "OpenFoal";
pptx.company = "OpenFoal";
pptx.subject = "openfoal-ppt-v1";
pptx.title = title;

const palette = theme === "business"
  ? { bg: "0F172A", fg: "FFFFFF", accent: "38BDF8" }
  : { bg: "1F2937", fg: "FFFFFF", accent: "60A5FA" };

const titleSlide = pptx.addSlide();
titleSlide.background = { color: palette.bg };
titleSlide.addText(title, {
  x: 0.7,
  y: 1.4,
  w: 11.8,
  h: 1.1,
  fontFace: "Calibri",
  fontSize: 38,
  bold: true,
  color: palette.fg,
  align: "left"
});
const subtitle = lang === "en-US" ? "Generated by openfoal-ppt-v1" : "由 openfoal-ppt-v1 自动生成";
titleSlide.addText(subtitle, {
  x: 0.7,
  y: 2.7,
  w: 11.4,
  h: 0.6,
  fontFace: "Calibri",
  fontSize: 16,
  color: "CBD5E1"
});

titleSlide.addShape(pptx.ShapeType.line, {
  x: 0.7,
  y: 3.45,
  w: 3.8,
  h: 0,
  line: { color: palette.accent, pt: 1.5 }
});

for (let i = 2; i <= slideCount; i += 1) {
  const slide = pptx.addSlide();
  slide.background = { color: "FFFFFF" };
  const sectionTitle = lang === "en-US" ? `Section ${i - 1}` : `第 ${i - 1} 部分`;
  const bodyHeader = lang === "en-US" ? "Key points" : "关键要点";
  slide.addText(sectionTitle, {
    x: 0.6,
    y: 0.4,
    w: 12,
    h: 0.8,
    fontFace: "Calibri",
    fontSize: 30,
    bold: true,
    color: "111827"
  });
  slide.addShape(pptx.ShapeType.roundRect, {
    x: 0.65,
    y: 1.35,
    w: 0.28,
    h: 0.28,
    rectRadius: 0.05,
    fill: { color: palette.accent },
    line: { color: palette.accent, pt: 0 }
  });
  slide.addText(bodyHeader, {
    x: 1.02,
    y: 1.26,
    w: 5,
    h: 0.45,
    fontFace: "Calibri",
    fontSize: 16,
    bold: true,
    color: "1F2937"
  });
  const lines = lang === "en-US"
    ? [`${sectionTitle} statement`, "Evidence and explanation", "Action for next step"]
    : [`${sectionTitle} 结论陈述`, "支撑证据与解释", "下一步行动建议"];
  slide.addText(lines.map((item) => ({ text: item, options: { bullet: { indent: 16 } } })), {
    x: 1.02,
    y: 1.85,
    w: 11.4,
    h: 3.8,
    fontFace: "Calibri",
    fontSize: 19,
    color: "111827",
    breakLine: true,
    paraSpaceAfterPt: 14
  });
  slide.addText(`${i - 1}/${slideCount - 1}`, {
    x: 11.2,
    y: 6.85,
    w: 2,
    h: 0.3,
    fontFace: "Calibri",
    fontSize: 11,
    color: "6B7280",
    align: "right"
  });
}

await pptx.writeFile({ fileName: outAbs });

const binary = await fs.readFile(outAbs);
const checksum = createHash("sha256").update(binary).digest("hex");
const meta = {
  skillId: "openfoal-ppt-v1",
  engine: "pptxgenjs",
  slideCount,
  title,
  outputPath: out,
  checksum,
  generatedAt: new Date().toISOString()
};
await fs.writeFile(`${outAbs}.meta.json`, `${JSON.stringify(meta, null, 2)}\n`, "utf8");
console.log(JSON.stringify(meta));
```

## Error Handling

- If `pptxgenjs` import fails, return explicit error: `MISSING_DEP:pptxgenjs`.
- If args JSON is invalid, return: `INVALID_ARGS: expected JSON object`.
- If `out` path escapes workspace, return: `INVALID_ARGS: out path escapes workspace`.

## Final Response Format

Return concise plaintext:

- `status: ok`
- `out: <path>`
- `slideCount: <n>`
- `meta: <path>.meta.json`
- `checksum: <sha256>`
